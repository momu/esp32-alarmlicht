# turn on the testbutton_led, switch REL1 on for 300ms and â€“ depending
# on the global boolean variables - do Divera and ntfy HTTP request
# to trigger test alerts via their API
- logger.log: 
    format: "Button BUT1 pressed"
    level: INFO
- output.turn_on: testbutton_led
# switch the relay off after 300ms
- output.turn_on: relay_1
- delay: ${relay_on_time}
- output.turn_off: relay_1
# only send alerts, when there is a wifi connection
- if: 
    condition:
      wifi.connected:
    then: !include 
      file: send-test-alerts.yaml
      vars:  
        divera_type: ${divera_type}
        ntfy_title: ${ntfy_title}
        ntfy_priority: ${ntfy_priority}
        ntfy_tags: ${ntfy_tags}
        ntfy_body: ${ntfy_body}
    else:
      - lambda: 'id(global_alert_pending) = true;'
      - lambda: 'id(global_pending_alert_type_test) = true;'
      - logger.log: 
          format: "No wifi connection, testalert set to pending."
          level: INFO